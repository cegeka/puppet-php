<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: concat</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;

    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }

  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )

  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">concat</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/home/bkfda/gitrepo/public/concat/manifests/fragment_pp.html">
                /home/bkfda/gitrepo/public/concat/manifests/fragment.pp
                </a>
        <br />
                <a href="../files/home/bkfda/gitrepo/public/concat/manifests/setup_pp.html">
                /home/bkfda/gitrepo/public/concat/manifests/setup.pp
                </a>
        <br />
                <a href="../files/home/bkfda/gitrepo/public/concat/manifests/init_pp.html">
                /home/bkfda/gitrepo/public/concat/manifests/init.pp
                </a>
        <br />
                <a href="../files/home/bkfda/gitrepo/public/concat/lib/facter/concat_basedir_rb.html">
                /home/bkfda/gitrepo/public/concat/lib/facter/concat_basedir.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

<!-- if childs -->

    <div id="method-list">
      <h3 class="section-bar">Defines</h3>

      <div class="name-list">
      <a href="#M000003">concat</a>&nbsp;&nbsp;
      <a href="#M000002">fragment</a>&nbsp;&nbsp;
      </div>
    </div>


  </div>


    <!-- if includes -->

    <!-- if requires -->

    <!-- if realizes -->

    <div id="section">

<!-- if facts -->
    <div id="class-list">
      <h3 class="section-bar">Custom Facts</h3>
            <a href="../plugins/concat_basedir.html">concat_basedir</a>&nbsp;&nbsp;
    </div>

<!-- if plugins -->

<!-- if nodes -->

<!-- if class -->
    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="concat/setup.html" class="link">concat::setup</a><br />

    </div>







    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Defines</h3>

      <div id="method-M000003" class="method-detail">
        <a name="M000003"></a>

        <div class="method-heading">
          <span class="method-name">concat</span><span class="method-args">( $force =&gt; 'false', $group =&gt; 'concat::setup::root_group', $gnu =&gt; 'true', $backup =&gt; 'puppet', $warn =&gt; 'false', $mode =&gt; '0644', $order =&gt; 'alpha', $owner =&gt; '::id' )</span>
        </div>

        <div class="method-description">
          <p>
A system to construct files using fragments from other files or templates.
</p>
<p>
This requires at least <a href="puppet.html">puppet</a> 0.25 to work
correctly as we use some enhancements in recursive directory management and
regular expressions to do the work here.
</p>
<p>
USAGE: The basic use case is as below:
</p>
<p>
<a href="concat.html#M000003">concat</a>{&#8217;/etc/named.conf&#8217;:
</p>
<pre>
   notify =&gt; Service['named']
</pre>
<p>
}
</p>
<p>
concat::fragment{&#8216;foo.com_config&#8217;:
</p>
<pre>
   target  =&gt; '/etc/named.conf',
   order   =&gt; 10,
   content =&gt; template('named_conf_zone.erb')
</pre>
<p>
}
</p>
<p>
# add a <a href="concat.html#M000002">fragment</a> not managed by <a
href="puppet.html">puppet</a> so local <a href="users.html">users</a> # can
add content to managed file
concat::fragment{&#8216;foo.com_user_config&#8217;:
</p>
<pre>
   target  =&gt; '/etc/named.conf',
   order   =&gt; 12,
   ensure  =&gt; '/etc/named.conf.local'
</pre>
<p>
}
</p>
<p>
This will use the template named_conf_zone.erb to build a single bit of
config up and put it into the fragments dir. The file will have an number
prefix of 10, you can use the order option to control that and thus control
the order the final file gets built in.
</p>
<p>
SETUP: The class <a href="concat/setup.html">concat::setup</a> defines a
variable $concatdir - you should set this to a directory where you want all
the temporary files and fragments to be stored. Avoid placing this
somewhere like /tmp since you should never delete files here, <a
href="puppet.html">puppet</a> will manage them.
</p>
<p>
There&#8216;s some regular expression magic to figure out the <a
href="puppet.html">puppet</a> version but if you&#8216;re on an older 0.24
version just set $puppetversion = 24
</p>
<p>
Before you can use any of the <a href="concat.html#M000003">concat</a>
features you should include the class <a
href="concat/setup.html">concat::setup</a> somewhere on your node first.
</p>
<p>
DETAIL: We use a helper shell script called concatfragments.sh that gets
placed in &lt;Puppet[:vardir]&gt;/concat/bin to do the concatenation. While
this might seem more complex than some of the one-liner alternatives you
might find on the net we do a lot of error checking and safety checks in
the script to avoid problems that might be caused by complex escaping
errors etc.
</p>
<p>
LICENSE: Apache Version 2
</p>
<p>
LATEST: <a
href="http://github.com/ripienaar/puppet-concat">github.com/ripienaar/puppet-concat</a>/
</p>
<p>
CONTACT: R.I.Pienaar &lt;rip@devco.net&gt; Volcane on freenode @ripienaar
on twitter <a href="http://www.devco.net">www.devco.net</a> Sets up so that
you can use fragments to build a final config file,
</p>
<p>
OPTIONS:
</p>
<pre>
 - mode       The mode of the final file
 - owner      Who will own the file
 - group      Who will own the file
 - force      Enables creating empty files if no fragments are present
 - warn       Adds a normal shell style comment top of the file indicating
              that it is built by puppet
 - backup     Controls the filebucketing behavior of the final file and
              see File type reference for its use.  Defaults to 'puppet'
</pre>
<p>
ACTIONS:
</p>
<pre>
 - Creates fragment directories if it didn't exist already
 - Executes the concatfragments.sh script to build the final file,
    this script will create directory/fragments.concat.
   Execution happens only when:
   * The directory changes
   * fragments.concat != final destination,
    this means rebuilds will happen whenever
     someone changes or deletes the final file.
    Checking is done using /usr/bin/cmp.
   * The Exec gets notified by something else -
      like the concat::fragment define
 - Copies the file over to the final destination using a file resource
</pre>
<p>
ALIASES:
</p>
<pre>
 - The exec can notified using Exec['concat_/path/to/file'] or
    Exec['concat_/path/to/directory']
 - The final file can be referened as File['/path/to/file'] or
    File['concat_/path/to/file']
</pre>
        </div>
      </div>

      <div id="method-M000002" class="method-detail">
        <a name="M000002"></a>

        <div class="method-heading">
          <span class="method-name">fragment</span><span class="method-args">( $group =&gt; 'concat::setup::root_group', $backup =&gt; 'puppet', $target, $mode =&gt; '0644', $owner =&gt; '::id', $ensure =&gt; 'present', $order =&gt; '10', $source =&gt; '', $content =&gt; '' )</span>
        </div>

        <div class="method-description">
          <p>
Puts a file <a href="concat.html#M000002">fragment</a> into a directory
previous <a href="concat/setup.html">setup</a> using <a
href="concat.html#M000003">concat</a>
</p>
<p>
OPTIONS:
</p>
<pre>
  - target    The file that these fragments belong to
  - content   If present puts the content into the file
  - source    If content was not specified, use the source
  - order     By default all files gets a 10_ prefix in the directory
              you can set it to anything else using this to influence the
              order of the content in the file
  - ensure    Present/Absent or destination to a file to include another file
  - mode      Mode for the file
  - owner     Owner of the file
  - group     Owner of the file
  - backup    Controls the filebucketing behavior of the final file and
              see File type reference for its use.  Defaults to 'puppet'
</pre>
        </div>
      </div>


    </div>


    <!-- if resource_list -->



  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>
